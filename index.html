<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SHINMART — Премиальный выбор шин</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --accent: #e74c3c; --bg: #fdfdfd; }
        body { font-family: 'Montserrat', sans-serif; margin: 0; padding: 15px; background: var(--bg); }
        .controls { background: white; padding: 20px; border-radius: 24px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .filter-group { margin-bottom: 20px; }
        .filter-group h4 { margin: 0 0 10px 0; font-size: 11px; font-weight: 700; color: #70757a; text-transform: uppercase; }
        .chips { display: flex; flex-wrap: nowrap; gap: 8px; overflow-x: auto; padding-bottom: 5px; }
        .chips::-webkit-scrollbar { display: none; }
        .chip { flex: 0 0 auto; padding: 10px 18px; border: 1px solid #eee; background: white; border-radius: 12px; cursor: pointer; font-size: 13px; font-family: 'Montserrat'; transition: 0.2s; }
        .chip.active { background: #121212; color: white; border-color: #121212; font-weight: 700; }
        #products { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #f0f0f0; }
        .card img { width: 100%; height: 180px; object-fit: contain; }
        .reset-btn { width: 100%; padding: 15px; border: none; background: #fff1f0; color: #f5222d; border-radius: 14px; font-weight: 700; cursor: pointer; margin-top: 10px; }
    </style>
</head>
<body>

<header style="text-align: center; padding: 20px;">
    <h1 style="font-weight: 900; margin: 0;">SHINMART<span style="color:var(--accent)">.</span></h1>
</header>

<div class="container">
    <div class="controls">
        <div class="filter-group">
            <h4>Тип шины (Сезон)</h4>
            <div id="typeChips" class="chips">
                <button class="chip active" data-all="true" onclick="resetGroup('сезон', this.parentElement)">Все</button>
                <button class="chip" onclick="toggleFilter('сезон', 'ШИПЫ', this, this.parentElement)">Шипы</button>
                <button class="chip" onclick="toggleFilter('сезон', 'ЛИПУЧКИ', this, this.parentElement)">Липучки</button>
            </div>
        </div>
        <div class="filter-group"><h4>Ширина</h4><div id="widthChips" class="chips"></div></div>
        <div class="filter-group"><h4>Высота</h4><div id="heightChips" class="chips"></div></div>
        <div class="filter-group"><h4>Диаметр</h4><div id="diamChips" class="chips"></div></div>
        <button class="reset-btn" onclick="resetFilters()">СБРОСИТЬ ВСЕ</button>
    </div>
    <div id="products">Загрузка данных из таблицы...</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<script>
const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRMe3Xbtzrt3WmiYKEOCv5WI_i4_cuR9AX1WxJrNKIHDXya8D1nwSq-YWhXz8wyS1BYWEN1g-bS5-y5/pub?output=csv";

let db = [], f = { сезон: [], ширина: [], высота: [], диаметр: [] };

Papa.parse(csvUrl, {
    download: true,
    header: true,
    complete: function(results) {
        // Приводим все ключи (заголовки) к нижнему регистру для надежности
        db = results.data.map(row => {
            let newRow = {};
            for (let key in row) {
                newRow[key.trim().toLowerCase()] = row[key].trim();
            }
            return newRow;
        });
        console.log("Данные загружены:", db[0]); // Проверка в консоли
        initFilters();
        render();
    }
});

function initFilters() {
    // Названия ключей теперь точно в нижнем регистре
    const config = [
        { key: 'ширина', id: 'widthChips' },
        { key: 'высота', id: 'heightChips' },
        { key: 'диаметр', id: 'diamChips' }
    ];

    config.forEach(conf => {
        const container = document.getElementById(conf.id);
        // Получаем уникальные значения и сортируем их
        let vals = [...new Set(db.map(p => p[conf.key]))]
            .filter(v => v && v !== "")
            .sort((a, b) => parseFloat(a) - parseFloat(b));

        let html = `<button class="chip active" data-all="true" onclick="resetGroup('${conf.key}', this.parentElement)">Все</button>`;
        vals.forEach(v => {
            html += `<button class="chip" onclick="toggleFilter('${conf.key}', '${v}', this, this.parentElement)">${v}</button>`;
        });
        container.innerHTML = html;
    });
}

function toggleFilter(key, val, btn, box) {
    const allBtn = box.querySelector('[data-all="true"]');
    if (f[key].includes(val)) {
        f[key] = f[key].filter(v => v !== val);
        btn.classList.remove('active');
    } else {
        f[key].push(val);
        btn.classList.add('active');
    }
    f[key].length === 0 ? allBtn.classList.add('active') : allBtn.classList.remove('active');
    render();
}

function resetGroup(key, box) {
    f[key] = [];
    box.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    box.querySelector('[data-all="true"]').classList.add('active');
    render();
}

function resetFilters() {
    f = { сезон: [], ширина: [], высота: [], диаметр: [] };
    document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    document.querySelectorAll('[data-all="true"]').forEach(c => c.classList.add('active'));
    render();
}

function render() {
    const list = document.getElementById("products");
    let data = db.filter(p => 
        (f.сезон.length === 0 || f.сезон.includes(p.сезон)) &&
        (f.ширина.length === 0 || f.ширина.includes(p.ширина)) &&
        (f.высота.length === 0 || f.высота.includes(p.высота)) &&
        (f.диаметр.length === 0 || f.диаметр.includes(p.диаметр))
    );

    list.innerHTML = data.length ? "" : "<p>Ничего не найдено</p>";
    data.forEach(p => {
        if(!p.бренд) return;
        const c = document.createElement("div");
        c.className = "card";
        c.innerHTML = `
            <img src="${p['фото 1'] || 'https://via.placeholder.com/200'}">
            <h3 style="font-size:16px;">${p.бренд}</h3>
            <p style="color:gray;">${p.размер}</p>
            <div style="font-size:20px; font-weight:900;">${p.цена} ₸</div>
        `;
        list.appendChild(c);
    });
}
</script>
</body>
</html>
